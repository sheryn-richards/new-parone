---
import '../styles/global.css';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';
import SEOHead from '../components/SEOHead.astro';
import { SITE } from '../config/site';

const { frontmatter, mdxFilePath = '' } = Astro.props;

// Debug logging (will show in Astro build output)
console.log('[DocsLayout] MDX file path:', mdxFilePath);

// Get all docs for sidebar navigation
const allDocs = await getCollection('docs');
const sortedDocs = allDocs.sort((a, b) => {
  const orderA = a.data.order ?? 999;
  const orderB = b.data.order ?? 999;
  return orderA - orderB;
});

// Group docs by section
const docsBySection = sortedDocs.reduce((acc, doc) => {
  const section = doc.data.section || 'Documentation';
  if (!acc[section]) {
    acc[section] = [];
  }
  acc[section].push(doc);
  return acc;
}, {} as Record<string, typeof sortedDocs>);
---

<!doctype html>
<html lang="en">
  <head>
    <SEOHead
      title={`${frontmatter.title} â€“ ${SITE.name}`}
      description={frontmatter.description}
      type="website"
      jsonLd={{
        '@context': 'https://schema.org',
        '@type': 'TechArticle',
        headline: frontmatter.title,
        description: frontmatter.description,
        url: new URL(Astro.url.pathname, SITE.url).toString(),
      }}
    />
  </head>
  <body class="min-h-screen" style="background: var(--background); color: var(--text);" data-ps="src/layouts/DocsLayout.astro:r1mhqx">
    <Navigation />

    <div class="container mx-auto flex px-4 pb-8" style="padding-top: var(--nav-height);" data-ps="src/layouts/DocsLayout.astro:upiaa4">
      <!-- Sidebar Navigation -->
      <aside class="hidden w-64 shrink-0 pr-8 lg:block" data-ps="src/layouts/DocsLayout.astro:4fgao7">
        <nav class="sticky top-24" data-ps="src/layouts/DocsLayout.astro:86mz6j">
          <h2 class="mb-4 text-sm font-semibold uppercase" style="color: var(--text-muted);" data-ps="src/layouts/DocsLayout.astro:jauq3x">Documentation</h2>
          {Object.entries(docsBySection).map(([section, docs]) => (
            <div class="mb-6" data-ps="src/layouts/DocsLayout.astro:upiaa5">
              {section !== 'Documentation' && (
                <h3 class="mb-2 text-sm font-semibold" style="color: var(--text);" data-ps="src/layouts/DocsLayout.astro:ff54ij">{section}</h3>
              )}
              <ul class="space-y-2">
                {docs.map((doc) => (
                  <li data-ps="src/layouts/DocsLayout.astro:uuiy8o">
                    <a
                      href={`/docs/${doc.slug}`}
                      class="block rounded px-3 py-1.5 text-sm transition-opacity opacity-70 hover:opacity-100"
                     data-ps="src/layouts/DocsLayout.astro:ldu2n">
                      {doc.data.title}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="min-w-0 flex-1" data-ps="src/layouts/DocsLayout.astro:po35e8">
        <article
          class="max-w-3xl"
          data-mdx-file={mdxFilePath}
          data-mdx-type="docs"
         data-ps="src/layouts/DocsLayout.astro:5e6nr3">
          <header class="mb-8" data-ps="src/layouts/DocsLayout.astro:jo1w2">
            <h1 class="mb-2 text-4xl md:text-5xl font-bold" data-ps="src/layouts/DocsLayout.astro:jrwd8u">{frontmatter.title}</h1>
            <p class="text-lg" style="color: var(--text-muted);" data-ps="src/layouts/DocsLayout.astro:7pbqsg">{frontmatter.description}</p>
          </header>

          <div class="prose prose-lg max-w-none" data-ps="src/layouts/DocsLayout.astro:upiaa6">
            <slot />
          </div>
        </article>
      </main>
    </div>

    <Footer />
  </body>
</html>
